name: Build NPM package
on:
  pull_request:
    types: [opened, reopened, synchronize]
    branches:
      - 'main'
  push:
    branches:
      - 'main'

jobs:
  init:
    runs-on: ubuntu-latest
    steps:
      - uses: milaboratory/github-ci/actions/context/init@v4
        with:
          version-canonize: false
          branch-versioning: main
  run:
    needs:
      - init

    uses: milaboratory/github-ci/.github/workflows/node-simple.yaml@v4-beta
    with:
      app-name: Blast PL package
      app-name-slug: 'blast'
      notify-telegram: true

      node-version: '20.x'
      is-electron-application: 'false'
      always-auth: 'true'

      build-script-name: 'build'

      test: false
      test-script-name: 'test'

      publish-script-name: 'release'

      aws-login-enable: false
      gcp-login-enable: false

    secrets:
      env: |
        {"PL_REGISTRY_PLATFORMA_OPEN_UPLOAD_URL": ${{ toJSON(secrets.PL_REGISTRY_PLOPEN_UPLOAD_URL) }} }

            AWS_ASSUME_ROLE:
        description: |
          Role to assume in AWS to assume during CI run.
        required: false

      AWS_ASSUME_REGION: "" #{{ secrets.AWS_CI_IAM_MONOREPO_SIMPLE_ROLE }}

      GCP_KMS_WORKLOAD_IDENTITY_PROVIDER: "" #{{ secrets.GCP_KMS_WORKLOAD_IDENTITY_PROVIDER }}
      GCP_KMS_SERVICE_ACCOUNT: "" #{{ secrets.GCP_KMS_SERVICE_ACCOUNT }}
      GCP_KMS_LOCATION: "" #{{ secrets.GCP_KMS_LOCATION }}
      GCP_KMS_KEYRING: "" #{{ secrets.GCP_KMS_KEYRING }}
      GCP_KMS_KEY_NAME: "" #{{ secrets.GCP_KMS_KEY_NAME }}


      TELEGRAM_NOTIFICATION_TARGET: "" #{{ secrets.TG_CHANNEL_MIBUILDS }}
      TELEGRAM_API_TOKEN: "" #{{ secrets.TG_CI_BOT_TOKEN }}
